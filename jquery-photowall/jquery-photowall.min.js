/*
    jQuery PhotoWall with ShowBox
    jQuery image gallery script with fullscreen mode.
    http://creotiv.github.com/jquery-photowall
    
    Copyright (C) 2012  Andrey Nikishaev(creotiv@gmail.com, http://creotiv.in.ua)

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
function getScrollBarWidth(){var b=document.createElement("p");b.style.width="100%";b.style.height="200px";var c=document.createElement("div");c.style.position="absolute";c.style.top="0px";c.style.left="0px";c.style.visibility="hidden";c.style.width="200px";c.style.height="150px";c.style.overflow="hidden";c.appendChild(b);document.body.appendChild(c);var d=b.offsetWidth;c.style.overflow="scroll";b=b.offsetWidth;if(d==b)b=c.clientWidth;document.body.removeChild(c);return d-b}
function $_GET(){a=location.hash.match(/[^&#=]*=[^&#=]*/g);r={};if(a)for(i=0;i<a.length;i++)r[a[i].match(/[^&#=]*/)[0]]=a[i].match(/=([^&#]*)/)[0].replace("=","");return r}
var PhotoWall={version:"0.1.4",_photos:{},_el:null,_c_width:0,_c_height:0,_first_big:null,_zoom_trigger:null,_zs:null,_zoom_timeout:null,_last_line:[],_must_resize:!1,_inited:!1,_block_resize:!1,_line_max_height:0,options:{lineMaxHeight:150,lineMaxHeightDynamic:!1,baseScreenHeight:600,isFirstBig:!1,firstBigWidthPercent:0.41,padding:10,zoomAction:"mouseenter",zoomTimeout:500,zoomDuration:300,zoomImageBorder:5,showBoxPadding:2,showBoxSocial:!0},init:function(b){PhotoWall.options=$.extend(PhotoWall.options,
b);PhotoWall._el=b.el+" .body";PhotoWall._c_width=$(PhotoWall._el).width()-getScrollBarWidth();PhotoWall._c_height=$(PhotoWall._el).height();PhotoWall._line_max_height=PhotoWall.options.lineMaxHeight;PhotoWall._setLineMaxHeightDynamic();$(PhotoWall._el).html("").addClass("clearfix");$(window).resize(PhotoWall.RESIZE)},_init_socials:function(){var b=document,c,d=b.getElementsByTagName("script")[0],e=function(e,g){if(!b.getElementById(g))c=b.createElement("script"),c.src=e,c.id=g,d.parentNode.insertBefore(c,
d)};e("https://connect.facebook.net/en_US/all.js#xfbml=1","fbjssdk");e("https://apis.google.com/js/plusone.js","gplus1js");e("https://platform.twitter.com/widgets.js","tweetjs")},_setLineMaxHeightDynamic:function(){if(PhotoWall.options.lineMaxHeightDynamic){var b=$(window).height()/PhotoWall.options.baseScreenHeight;PhotoWall.options.lineMaxHeight=100<=PhotoWall._line_max_height*b?PhotoWall._line_max_height*b:100}},RESIZE:function(){var b=$(PhotoWall._el).width(),c=$(PhotoWall._el).height();PhotoWall._setLineMaxHeightDynamic();
if(!(!PhotoWall.options.lineMaxHeightDynamic&&PhotoWall._c_width==b||PhotoWall._block_resize))ShowBox.opened()?PhotoWall._must_resize=!0:(PhotoWall._c_width=b,PhotoWall._c_height=c,PhotoWall._must_resize=!1,$(PhotoWall._el).html(""),PhotoWall.show())},load:function(b){if(!PhotoWall.options.lineMaxHeightDynamic)for(var c in b)b[c].th.width=Math.floor(b[c].th.width*(PhotoWall.options.lineMaxHeight/b[c].th.height)),b[c].th.height=PhotoWall.options.lineMaxHeight;PhotoWall._photos=b;PhotoWall.show()},
show:function(b){var c=[],d=[],e=0;if(b)c=b,d=PhotoWall._last_line[0],e=PhotoWall._last_line[1];else{if(!PhotoWall._photos)return;$(PhotoWall._el).html("");$(window).scrollTop(0);c=PhotoWall._photos}var h=function(b,c,e,d,g,f,h,l){var j="",k="";h&&l&&(j="position:absolute;left:-"+Math.round((e-h)/2)+"px;top:-"+Math.round((d-l)/2)+"px;",k="pw-crop");b=$('<div id="'+b+'" class="pw-photo '+k+' clearfix" style="margin:'+c+"px;width:"+e+"px;height:"+d+'px;float:left;"><a class="pw-link" href="'+g+'"><img class="pw-zoom" src="'+
f+'" width="'+e+'" height="'+d+'" style="'+j+'" /></a></div>');$.browser.msie?b.find("img").hide().load(function(){$(this).fadeIn(300)}):b.find("img").css("opacity",0).load(function(){$(this).delay(700*Math.random()+300).animate({opacity:1},{duration:1E3})});return b},b=function(b,c,e,d){var g=$("<div class='pw-line' style='width:"+(c+2*f*PhotoWall.options.padding)+"'></div>").appendTo(PhotoWall._el),f=b.length,d=d?PhotoWall._c_width*PhotoWall.options.firstBigWidthPercent+2*PhotoWall.options.padding:
0,c=(PhotoWall._c_width-d-2*f*PhotoWall.options.padding)/c;e&&(c=1);var l=0,j;for(j in b){var k=Math.floor(b[j].th.width*c),m=Math.floor(b[j].th.height*c),l=l+k;!e&&j==f-1&&(k+=PhotoWall._c_width-d-2*f*PhotoWall.options.padding-l);k=h(b[j].id,PhotoWall.options.padding,k,m,b[j].img,b[j].th.src);g.prepend(k)}return k},g=0,f=2*PhotoWall.options.padding,j=!0,k;for(k in c){var n=0,m=!1;if(PhotoWall.options.lineMaxHeightDynamic){var l=PhotoWall.options.lineMaxHeight/c[k].th.height;c[k].th.width=Math.floor(c[k].th.width*
l);c[k].th.height=PhotoWall.options.lineMaxHeight}if(PhotoWall.options.isFirstBig&&j)PhotoWall._first_big=c[k],j=!1;else{if(2>g&&PhotoWall.options.isFirstBig)l=PhotoWall._first_big.th.height,m=!0,n=PhotoWall._c_width*PhotoWall.options.firstBigWidthPercent;d.push(c[k]);e+=c[k].th.width;if(e>=PhotoWall._c_width-n)l=b(d,e,0,m),2>g&&(f+=l.height()),PhotoWall._last_line=[d,e,l],d=[],e=0,g++}}if(PhotoWall.options.isFirstBig)f=PhotoWall._first_big,l=PhotoWall._c_width*PhotoWall.options.firstBigWidthPercent/
c[k].width,c=f.width*l,l*=f.height,f.th.width=c,f.th.height=l,f.th.src=f.img,f.th.zoom_src=f.img,PhotoWall._first_big=h(f.id,PhotoWall.options.padding,c,l,f.img,f.img).prependTo(PhotoWall._el);if(d)2>g&&PhotoWall.options.isFirstBig&&(m=!0),l=b(d,e,1,m),PhotoWall._last_line=[d,e,l];PhotoWall._c_width<$(PhotoWall._el).width()&&PhotoWall.RESIZE();if(!PhotoWall._inited)PhotoWall._inited=!0,PhotoWall.initGUI()},initGUI:function(){PhotoWall.options.zoom&&PhotoWall.initZoom();PhotoWall.options.showBox&&
PhotoWall.initShowBox()},initShowBox:function(){var b="",c=null;PhotoWall.options.showBoxSocial&&(b='<div style="padding-top: 5px;width: 250px;position: relative;left: 50%;margin-left: -125px;"><div style="float:left;margin-top: 5px;width:80px;"><div id="gplus" class="g-plusone" data-size="medium"></div></div><div style="float:left;margin-top:5px;width:90px;"><a href="https://twitter.com/share" class="twitter-share-button">Tweet</a></div><div style="float:left;margin-top:5px;width:80px;" id="fblike"><fb:like send="false" layout="button_count" width="100" show_faces="false"></fb:like></div></div>',
c=function(){"undefined"!==typeof FB&&FB.XFBML.parse(document.getElementById("fblike"));"undefined"!==typeof gapi&&gapi.plusone.render(document.getElementById("gplus"),{href:location.href,annotation:"bubble",width:90,align:"left",size:"medium"});"undefined"!==typeof twttr&&($("#showbox .twitter-share-button").attr("data-url",location.href),twttr.widgets.load())});ShowBox.init("#gallery a.pw-link",{closeCallback:function(){PhotoWall._must_resize&&PhotoWall.RESIZE()},menuBarContent:b,onUpdate:c});PhotoWall.options.showBoxSocial&&
PhotoWall._init_socials()},initZoom:function(){$(".pw-zoom").live(PhotoWall.options.zoomAction,function(){var b=$(this);if(parseInt(b.css("opacity")))b.stop().addClass("pw-photo-hover"),PhotoWall._zoom_timeout=setTimeout(function(){b.removeClass("pw-photo-hover");b.addClass("pw-photo-zoomed");if(PhotoWall._zoom_timeout){PhotoWall._zs=[b.width(),b.height()];var c=b.parent().parent(),d=PhotoWall._photos[c.attr("id")],e=$("<img/>");e.attr("src",d.th.zoom_src);e.load(function(){b.attr("src",$(this).attr("src"));
$(this).remove()});var e=Math.round(b.width()*d.th.zoom_factor),d=Math.round(b.height()*d.th.zoom_factor),h=e-b.width(),g=d-b.height(),h=0.5*-h-PhotoWall.options.zoomImageBorder,g=0.5*-g-PhotoWall.options.zoomImageBorder,c=c.offset(),f=$(window),j=1;c.left+h+e>f.width()+f.scrollLeft()&&(h-=c.left+h+e-(f.width()+f.scrollLeft())+2*PhotoWall.options.zoomImageBorder);c.left+h<f.scrollLeft()&&(h-=c.left+h-f.scrollLeft());c.top+g+d>f.height()+f.scrollTop()&&(g-=c.top+g+d-(f.height()+f.scrollTop())+2*PhotoWall.options.zoomImageBorder);
c.top+g<f.scrollTop()&&(g-=c.top+g-f.scrollTop());e+2*PhotoWall.options.zoomImageBorder>f.width()&&(j*=(f.width()-2*PhotoWall.options.zoomImageBorder)/(e+2*PhotoWall.options.zoomImageBorder));d*j+2*PhotoWall.options.zoomImageBorder>f.height()&&(j*=(f.height()-2*PhotoWall.options.zoomImageBorder)/(d*j+2*PhotoWall.options.zoomImageBorder));b.animate({"margin-left":h,"margin-top":g,width:Math.round(e*j),height:Math.round(d*j),padding:PhotoWall.options.zoomImageBorder},{queue:!1,duration:PhotoWall.options.zoomDuration,
easing:"linear"})}},PhotoWall.options.zoomTimeout)});$(".pw-zoom").live("mouseleave",function(){var b=$(this);b.parent().parent().attr("id");if(PhotoWall._zoom_timeout)clearTimeout(PhotoWall._zoom_timeout),PhotoWall._zoom_timeout=null;b.removeClass("pw-photo-hover");if(b.hasClass("pw-photo-zoomed"))b.stop().css({margin:"",padding:"",width:PhotoWall._zs[0]+"px",height:PhotoWall._zs[1]+"px"}),PhotoWall._zs=null,b.removeClass("pw-photo-zoomed")})}},ShowBox={version:"0.1.4a",_opened:!1,_preview_locked:!1,
_images:[],_index:0,_current:"",_inited:!1,_th:null,options:{closeCallback:function(){},menuBarContent:"",onUpdate:null},init:function(b,c){ShowBox.options=$.extend(ShowBox.options,c);ShowBox._init(b);ShowBox._initEvents(b);ShowBox._parseGet()},_init:function(b){ShowBox._images.push([]);var c=ShowBox.options.menuBarContent;ShowBox.options.menuBarContent&&(c='<div class="showbox-menubar unselect" unselectable="on" style="display:none !important;">'+ShowBox.options.menuBarContent+"</div>");ShowBox._inited||
$('<div id="showbox" style="display:none;">    <div id="showbox-exit"></div>'+c+'    <div class="showbox-image unselect" unselectable="on">    </div>    <div id="showbox-loader"></div>    <div class="showbox-preview unselect">        <div class="showbox-pv-lock"></div>        <div class="showbox-th-counter" unselectable="on"></div>    </div></div>').appendTo("body");$("body").append('<div id="showbox-thc'+(ShowBox._images.length-1)+'" style="overflow:hidden;position:relative;width:100%;"><div class="showbox-th-container clearfix" style="position:abolute;top:-999999px;"></div></div>');
var d=0,e=ShowBox._images.length-1;$(b).each(function(){var b=$(this);ShowBox._images[e].push([b.attr("href"),b.find("img").attr("src")]);ShowBox._addThumb(e,ShowBox._images[e][d][1],d);d++})},_initEvents:function(b){b&&$(b).live("click",function(b){b.preventDefault();ShowBox._opened=!0;b=ShowBox._images.length-1;ShowBox._current=b;var d=$(this),e;for(e in ShowBox._images[b])if(ShowBox._images[b][e][0]==d.attr("href")){ShowBox._index=parseInt(e);ShowBox._th=$("#showbox-thc"+b+" .showbox-th").eq(e).addClass("showbox-th-active");
break}ShowBox._show(b)});if(!ShowBox._inited)ShowBox._inited=!0,$(document).keyup(function(b){ShowBox._opened&&ShowBox.KEYPRESSED(b)}),$("#showbox-exit").click(function(){ShowBox._opened&&ShowBox.EXIT(this)}),$("#showbox .showbox-preview").mouseenter(function(){ShowBox._preview_locked||ShowBox.OPENPREVIEW(this)}),$("#showbox .showbox-preview").mouseleave(function(){ShowBox._opened&&(ShowBox._preview_locked||ShowBox.CLOSEPREVIEW(this))}),$("#showbox .showbox-preview").click(function(){ShowBox._opened&&
ShowBox.LOCKPREVIEW(this)}),$(window).resize(function(){ShowBox.RESIZE(this)})},_parseGet:function(){var b=$_GET();if(b.p&&b.gal){ShowBox._opened=!0;var c=parseInt(b.gal)-1,b=parseInt(b.p)-1;ShowBox._index=b;ShowBox._current=c;ShowBox._th=$("#showbox-thc"+c+" .showbox-th").eq(b).addClass("showbox-th-active");ShowBox._show(c)}},_next:function(){var b=ShowBox._images[ShowBox._current].length;ShowBox._index+=1;if(ShowBox._index>=b)ShowBox._index=0;ShowBox._changeImage(ShowBox._index)},_prev:function(){var b=
ShowBox._images[ShowBox._current].length;ShowBox._index-=1;if(0>ShowBox._index)ShowBox._index=b-1;ShowBox._changeImage(ShowBox._index)},_show:function(b){$("#showbox-thc"+b).detach().appendTo("#showbox .showbox-preview");$("#showbox-thc"+b+" .showbox-th-container").css({position:"",top:"0px"});$("#showbox-loader").show();$("body").css("overflow","hidden");$("#showbox").fadeIn(200,function(){ShowBox._changeImage(ShowBox._index)})},_addThumb:function(b,c,d){$('<div class="showbox-th"><img src="'+c+
'" /></div>').appendTo("#showbox-thc"+b+" .showbox-th-container").find("img").load(function(){var b=$(this).width(),c=$(this).height(),d=0,d=1,d=b>=c?60/c:60/b,b=Math.round(b*d),c=Math.round(c*d),d=Math.round((b-60)/2);$(this).attr({width:b,height:c}).css({left:-d,top:-0.0})}).parent().click(function(b){b.stopPropagation();ShowBox._changeImage(d)})},_onChangePhoto:function(){if("function"==typeof ShowBox.options.onUpdate)ShowBox.options.onUpdate()},_changeImage:function(b){$("#showbox-loader").show();
$("#showbox .showbox-menubar").hide();$("#showbox .showbox-menubar div").remove();b=parseInt(b);ShowBox._setCounter(b+1,ShowBox._images[ShowBox._current].length);window.location.hash="p="+(b+1)+"&gal="+(ShowBox._current+1);$("#showbox .showbox-menubar").append(ShowBox.options.menuBarContent);ShowBox._onChangePhoto();ShowBox._index=b;$("#showbox .showbox-img").remove();ShowBox._th.removeClass("showbox-th-active");ShowBox._th=$("#showbox .showbox-th").eq(b).addClass("showbox-th-active");$('<img class="showbox-img" style="display:none;"/>').prependTo("#showbox .showbox-image").click(ShowBox._next).attr("src",
ShowBox._images[ShowBox._current][b][0]).load(function(){var b=$(this).width(),d=$(this).height();$(this).attr({width:b,height:d}).fadeIn(400);$("#showbox-loader").hide();$("#showbox .showbox-menubar").show();ShowBox.RESIZE()})},_setCounter:function(b,c){$("#showbox .showbox-th-counter").html(b+" of "+c)},_clearHash:function(){window.location.hash="_"},opened:function(){return ShowBox._opened},EXIT:function(){ShowBox._clearHash();ShowBox._opened=!1;$("body").css("overflow","auto");$("#showbox").hide();
ShowBox.options.closeCallback();$("#showbox .showbox-menubar").hide();$("#showbox .showbox-image img").remove();$("#showbox-thc"+ShowBox._current+" .showbox-th-container").css({position:"absolute",top:"-10000px"});$("#showbox-thc"+ShowBox._current).detach().appendTo("body")},KEYPRESSED:function(b){27==b.keyCode&&ShowBox.EXIT();39==b.keyCode&&ShowBox._next();37==b.keyCode&&ShowBox._prev()},OPENPREVIEW:function(b){$(b).animate({bottom:0},{queue:!1,duration:150})},CLOSEPREVIEW:function(b){$(b).animate({bottom:-75},
{queue:!1,duration:150})},LOCKPREVIEW:function(b){ShowBox._preview_locked=ShowBox._preview_locked?!1:!0;ShowBox._preview_locked?($("#showbox .showbox-pv-lock").show(),$(b).css({background:"#111","border-top":"1px solid #383838"})):($("#showbox .showbox-pv-lock").hide(),$(b).css({background:"","border-top":""}))},RESIZE:function(){if(ShowBox._opened){var b=$("#showbox"),c=$("#showbox .showbox-image img"),d=b.width(),e=b.height()-146;ShowBox.options.menuBarContent||(e=b.height()-111);var b=parseInt(c.attr("height")),
h=parseInt(c.attr("width")),g=1;b>e&&(g=e/b);h>d&&(g*=d/h);c=Math.round(g*h);g=Math.round(g*b);if(g>b||c>h)c=h,g=b;b=Math.round((d-c)/2);e=Math.round((e-g)/2)+5;$("#showbox .showbox-image").css({width:c+"px",height:g+"px","margin-left":b+"px","margin-top":e+"px"}).find(" img").css({width:c+"px",height:g+"px"});d=Math.round(d/2)-(64*ShowBox._index+30);$("#showbox .showbox-th-container").animate({left:d},{duration:300,queue:!1})}}};
