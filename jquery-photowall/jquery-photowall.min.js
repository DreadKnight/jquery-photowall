/*
    jQuery PhotoWall with ShowBox
    jQuery image gallery script with fullscreen mode.
    
    Copyright (C) 2012  Andrey Nikishaev(creotiv@gmail.com)

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
function getScrollBarWidth(){var b=document.createElement("p");b.style.width="100%";b.style.height="200px";var c=document.createElement("div");c.style.position="absolute";c.style.top="0px";c.style.left="0px";c.style.visibility="hidden";c.style.width="200px";c.style.height="150px";c.style.overflow="hidden";c.appendChild(b);document.body.appendChild(c);var d=b.offsetWidth;c.style.overflow="scroll";b=b.offsetWidth;if(d==b)b=c.clientWidth;document.body.removeChild(c);return d-b}
function $_GET(){a=location.hash.substr(2).match(/[^&#=]*=[^&#=]*/g);r={};if(a)for(i=0;i<a.length;i++)r[a[i].match(/[^&#=]*/)[0]]=a[i].match(/=([^&#]*)/)[0].replace("=","");return r}
var PhotoWall={version:"0.1.4b",_photos:{},_el:null,_next_line_factor:0.95,_remove_image_factor:1.15,_c_width:0,_c_height:0,_zoom_trigger:null,_zs:null,_zoom_timeout:null,_last_line:[],_must_resize:!1,_inited:!1,_block_resize:!1,options:{lineMaxHeight:150,isFirstBig:!1,padding:10,zoomAction:"mouseenter",zoomTimeout:500,zoomDuration:300,showBoxPadding:2,showBoxThumbSize:60,showBoxSocial:!0},init:function(b){PhotoWall.options=$.extend(PhotoWall.options,b);PhotoWall._el=b.el+" .body";PhotoWall._c_width=
$(PhotoWall._el).width()-getScrollBarWidth();PhotoWall._c_height=$(PhotoWall._el).height();$(PhotoWall._el).html("").addClass("clearfix");$(window).resize(PhotoWall._resize)},_init_socials:function(){var b=document,c,d=b.getElementsByTagName("script")[0],e=function(e,f){if(!b.getElementById(f))c=b.createElement("script"),c.src=e,c.id=f,d.parentNode.insertBefore(c,d)};e("https://connect.facebook.net/en_US/all.js#xfbml=1","fbjssdk");e("https://apis.google.com/js/plusone.js","gplus1js");e("https://platform.twitter.com/widgets.js",
"tweetjs")},_resize:function(){var b=$(PhotoWall._el).width(),c=$(PhotoWall._el).height();if(!(PhotoWall._c_width==b||PhotoWall._block_resize))ShowBox.opened()?PhotoWall._must_resize=!0:(PhotoWall._c_width=b,PhotoWall._c_height=c,PhotoWall._must_resize=!1,$(PhotoWall._el).html(""),PhotoWall.show())},load:function(b){var c=[],d;for(d in b){var e=b[d],h=e.th[1].height/e.th[0].height;b[d].th[0].width=Math.floor(b[d].th[0].width*(PhotoWall.options.lineMaxHeight/e.th[0].height));b[d].th[0].height=PhotoWall.options.lineMaxHeight;
b[d].th[1].width=Math.floor(b[d].th[0].width*h);b[d].th[1].height=Math.floor(b[d].th[0].height*h);c.push(b[d])}PhotoWall._photos=b;PhotoWall.show()},show:function(b){var c=[],d=[],e=0;if(b)c=b,d=PhotoWall._last_line[0],e=PhotoWall._last_line[1];else{if(!PhotoWall._photos)return;$(PhotoWall._el).html("");$(window).scrollTop(0);c=PhotoWall._photos}var h="display:inline-block;";$.browser.msie&&(h="float:left;");var b=function(b,c,d){var e=$("<div class='line' style='float:left'></div>").appendTo(PhotoWall._el),
c=PhotoWall._c_width/c;d&&(c=1);var f=0,g=b.length,k;for(k in b){var j=Math.round(b[k].th[0].width*c),l=Math.round(b[k].th[0].height*c),f=f+(j+PhotoWall.options.padding);g-1==k&&!d&&(j+=PhotoWall._c_width-f,f+=PhotoWall._c_width-f);j=$('<div id="'+b[k].id+'" class="pw-photo clearfix" style="position:relative;margin:'+Math.round(PhotoWall.options.padding/2)+"px;top:0px;left:0px;width:"+j+"px;height:"+l+"px;"+h+'"><a class="pw-link" href="'+b[k].img+'"><img class="pw-zoom" style="position:absolute;top:0px;left:0px;" src="'+
b[k].th[0].src+'" width="'+j+'" height="'+l+'" /></a></div>');$.browser.msie?j.find("img").hide().load(function(){$(this).fadeIn(300)}):j.find("img").css("opacity",0).load(function(){$(this).delay(700*Math.random()+300).animate({opacity:1},{duration:1E3})});e.append(j)}return e},f;for(f in c){var g=c[f];d.push(g);e+=g.th[0].width+PhotoWall.options.padding;e>=PhotoWall._c_width*PhotoWall._next_line_factor&&e<=PhotoWall._c_width*PhotoWall._remove_image_factor?(g=b(d,e),PhotoWall._last_line=[d,e,g],
d=[],e=0):e>=PhotoWall._c_width*PhotoWall._next_line_factor&&e>PhotoWall._c_width*PhotoWall._remove_image_factor&&(d.pop(),b(d,e-g.th[0].width-PhotoWall.options.padding),d=[g],e=g.th[0].width+PhotoWall.options.padding)}if(d)g=b(d,e,1),PhotoWall._last_line=[d,e,g];PhotoWall.initGUI()},initGUI:function(){if(!PhotoWall._inited)PhotoWall._inited=!0,PhotoWall.options.zoom&&PhotoWall.initZoom(),PhotoWall.options.showBox&&PhotoWall.initShowBox()},initShowBox:function(){var b="",c=null;PhotoWall.options.showBoxSocial&&
(b='<div style="padding-top: 5px;width: 250px;position: relative;left: 50%;margin-left: -125px;"><div style="float:left;margin-top: 5px;width:80px;"><div id="gplus" class="g-plusone" data-size="medium"></div></div><div style="float:left;margin-top:5px;width:90px;"><a href="https://twitter.com/share" class="twitter-share-button">Tweet</a></div><div style="float:left;margin-top:5px;width:80px;" id="fblike"><fb:like send="false" layout="button_count" width="100" show_faces="false"></fb:like></div></div>',
c=function(){"undefined"!==typeof FB&&FB.XFBML.parse(document.getElementById("fblike"));"undefined"!==typeof gapi&&gapi.plusone.render(document.getElementById("gplus"),{href:location.href,annotation:"bubble",width:90,align:"left",size:"medium"});"undefined"!==typeof twttr&&($("#showbox .twitter-share-button").attr("data-url",location.href),twttr.widgets.load())});ShowBox.init("#gallery a.pw-link",{closeCallback:function(){PhotoWall._must_resize&&PhotoWall._resize()},menuBarContent:b,onUpdate:c});
PhotoWall.options.showBoxSocial&&PhotoWall._init_socials()},initZoom:function(){$(".pw-zoom").live(PhotoWall.options.zoomAction,function(){var b=$(this);if(parseInt(b.css("opacity")))b.stop().addClass("pw-photo-hover"),PhotoWall._zoom_timeout=setTimeout(function(){b.removeClass("pw-photo-hover");b.addClass("pw-photo-zoomed");if(PhotoWall._zoom_timeout){PhotoWall._zs=[b.width(),b.height()];var c=b.parent().parent(),d=PhotoWall._photos[c.attr("id")],e=$("<img/>");e.attr("src",d.th[1].src);e.load(function(){b.attr("src",
$(this).attr("src"));$(this).remove()});var e=d.th[1].width,h=d.th[1].height,f=0.5*-(d.th[1].width-d.th[0].width)-0.5*PhotoWall.options.padding,d=0.5*-(d.th[1].height-d.th[0].height)-0.5*PhotoWall.options.padding,c=c.offset(),g=$(window);c.left+f+e>g.width()+g.scrollLeft()&&(f-=c.left+f+e-(g.width()+g.scrollLeft())+2*PhotoWall.options.padding);c.left+f<g.scrollLeft()&&(f-=c.left+f-g.scrollLeft());c.top+d+h>g.height()+g.scrollTop()&&(d-=c.top+d+h-(g.height()+g.scrollTop())+2*PhotoWall.options.padding);
c.top+d<g.scrollTop()&&(d-=c.top+d-g.scrollTop());b.animate({"margin-left":f,"margin-top":d,width:e+PhotoWall.options.padding,height:h+PhotoWall.options.padding,padding:0.5*PhotoWall.options.padding},{queue:!1,duration:PhotoWall.options.zoomDuration,easing:"linear"})}},PhotoWall.options.zoomTimeout)});$(".pw-zoom").live("mouseleave",function(){var b=$(this);b.parent().parent().attr("id");if(PhotoWall._zoom_timeout)clearTimeout(PhotoWall._zoom_timeout),PhotoWall._zoom_timeout=null;b.removeClass("pw-photo-hover");
b.hasClass("pw-photo-zoomed")&&b.stop().animate({"margin-left":"0px","margin-top":"0px",width:PhotoWall._zs[0]+"px",height:PhotoWall._zs[1]+"px"},{duration:50,queue:!1,complete:function(){PhotoWall._zs=null;b.removeClass("pw-photo-zoomed").css({margin:"",padding:""})}})})}},ShowBox={version:"0.1.4a",_opened:!1,_preview_locked:!1,_images:[],_index:0,_current:"",_inited:!1,_th:null,options:{closeCallback:function(){},menuBarContent:"",onUpdate:null},init:function(b,c){ShowBox.options=$.extend(ShowBox.options,
c);ShowBox._init(b);ShowBox._initEvents(b);ShowBox._parseGet()},_init:function(b){ShowBox._images.push([]);var c=ShowBox.options.menuBarContent;ShowBox.options.menuBarContent&&(c='<div class="showbox-menubar unselect" unselectable="on" style="display:none !important;">'+ShowBox.options.menuBarContent+"</div>");ShowBox._inited||$('<div id="showbox" style="display:none;">    <div id="showbox-exit"></div>'+c+'    <div class="showbox-image unselect" unselectable="on">    </div>    <div id="showbox-loader"></div>    <div class="showbox-preview unselect">        <div class="showbox-pv-lock"></div>        <div class="showbox-th-counter" unselectable="on"></div>    </div></div>').appendTo("body");
$("body").append('<div id="showbox-thc'+(ShowBox._images.length-1)+'" style="overflow:hidden;position:relative;width:100%;"><div class="showbox-th-container clearfix" style="position:abolute;top:-999999px;"></div></div>');var d=0,e=ShowBox._images.length-1;$(b).each(function(){var b=$(this);ShowBox._images[e].push([b.attr("href"),b.find("img").attr("src")]);ShowBox._addThumb(e,ShowBox._images[e][d][1],d);d++})},_initEvents:function(b){b&&$(b).live("click",function(b){b.preventDefault();ShowBox._opened=
!0;b=ShowBox._images.length-1;ShowBox._current=b;var d=$(this),e;for(e in ShowBox._images[b])if(ShowBox._images[b][e][0]==d.attr("href")){ShowBox._index=parseInt(e);ShowBox._th=$("#showbox-thc"+b+" .showbox-th").eq(e).addClass("showbox-th-active");break}ShowBox._show(b)});if(!ShowBox._inited)ShowBox._inited=!0,$(document).keyup(function(b){ShowBox._opened&&ShowBox.KEYPRESSED(b)}),$("#showbox-exit").click(function(){ShowBox._opened&&ShowBox.EXIT(this)}),$("#showbox .showbox-preview").mouseenter(function(){ShowBox._preview_locked||
ShowBox.OPENPREVIEW(this)}),$("#showbox .showbox-preview").mouseleave(function(){ShowBox._opened&&(ShowBox._preview_locked||ShowBox.CLOSEPREVIEW(this))}),$("#showbox .showbox-preview").click(function(){ShowBox._opened&&ShowBox.LOCKPREVIEW(this)}),$(window).resize(function(){ShowBox.RESIZE(this)})},_parseGet:function(){var b=$_GET();if(b.p&&b.gal){ShowBox._opened=!0;var c=parseInt(b.gal)-1,b=parseInt(b.p)-1;ShowBox._index=b;ShowBox._current=c;ShowBox._th=$("#showbox-thc"+c+" .showbox-th").eq(b).addClass("showbox-th-active");
ShowBox._show(c)}},_next:function(){var b=ShowBox._images[ShowBox._current].length;ShowBox._index+=1;if(ShowBox._index>=b)ShowBox._index=0;ShowBox._changeImage(ShowBox._index)},_prev:function(){var b=ShowBox._images[ShowBox._current].length;ShowBox._index-=1;if(0>ShowBox._index)ShowBox._index=b-1;ShowBox._changeImage(ShowBox._index)},_show:function(b){$("#showbox-thc"+b).detach().appendTo("#showbox .showbox-preview");$("#showbox-thc"+b+" .showbox-th-container").css({position:"",top:"0px"});$("#showbox-loader").show();
$("body").css("overflow","hidden");$("#showbox").fadeIn(200,function(){ShowBox._changeImage(ShowBox._index)})},_addThumb:function(b,c,d){$('<div class="showbox-th"><img src="'+c+'" /></div>').appendTo("#showbox-thc"+b+" .showbox-th-container").find("img").load(function(){var b=$(this).width(),c=$(this).height(),d=0,d=1,d=b>=c?60/c:60/b,b=Math.round(b*d),c=Math.round(c*d),d=Math.round((b-60)/2);$(this).attr({width:b,height:c}).css({left:-d,top:-0.0})}).parent().click(function(b){b.stopPropagation();
ShowBox._changeImage(d)})},_onChangePhoto:function(){if("function"==typeof ShowBox.options.onUpdate)ShowBox.options.onUpdate()},_changeImage:function(b){$("#showbox-loader").show();$("#showbox .showbox-menubar").hide();$("#showbox .showbox-menubar div").remove();b=parseInt(b);ShowBox._setCounter(b+1,ShowBox._images[ShowBox._current].length);window.location.hash="!p="+(b+1)+"&gal="+(ShowBox._current+1);$("#showbox .showbox-menubar").append(ShowBox.options.menuBarContent);ShowBox._onChangePhoto();ShowBox._index=
b;$("#showbox .showbox-img").remove();ShowBox._th.removeClass("showbox-th-active");ShowBox._th=$("#showbox .showbox-th").eq(b).addClass("showbox-th-active");$('<img class="showbox-img" style="display:none;"/>').prependTo("#showbox .showbox-image").click(ShowBox._next).attr("src",ShowBox._images[ShowBox._current][b][0]).load(function(){var b=$(this).width(),d=$(this).height();$(this).attr({width:b,height:d}).fadeIn(400);$("#showbox-loader").hide();$("#showbox .showbox-menubar").show();ShowBox.RESIZE()})},
_setCounter:function(b,c){$("#showbox .showbox-th-counter").html(b+" of "+c)},_clearHash:function(){window.location.hash="!"},opened:function(){return ShowBox._opened},EXIT:function(){ShowBox._clearHash();ShowBox._opened=!1;$("body").css("overflow","auto");$("#showbox").hide();ShowBox.options.closeCallback();$("#showbox .showbox-menubar").hide();$("#showbox .showbox-image img").remove();$("#showbox-thc"+ShowBox._current+" .showbox-th-container").css({position:"absolute",top:"-10000px"});$("#showbox-thc"+
ShowBox._current).detach().appendTo("body")},KEYPRESSED:function(b){27==b.keyCode&&ShowBox.EXIT();39==b.keyCode&&ShowBox._next();37==b.keyCode&&ShowBox._prev()},OPENPREVIEW:function(b){$(b).animate({bottom:0},{queue:!1,duration:150})},CLOSEPREVIEW:function(b){$(b).animate({bottom:-75},{queue:!1,duration:150})},LOCKPREVIEW:function(b){ShowBox._preview_locked=ShowBox._preview_locked?!1:!0;ShowBox._preview_locked?($("#showbox .showbox-pv-lock").show(),$(b).css({background:"#111","border-top":"1px solid #383838"})):
($("#showbox .showbox-pv-lock").hide(),$(b).css({background:"","border-top":""}))},RESIZE:function(){if(ShowBox._opened){var b=$("#showbox"),c=$("#showbox .showbox-image img"),d=b.width(),e=b.height()-146;ShowBox.options.menuBarContent||(e=b.height()-111);var b=parseInt(c.attr("height")),h=parseInt(c.attr("width")),f=1;b>e&&(f=e/b);h>d&&(f*=d/h);c=Math.round(f*h);f=Math.round(f*b);if(f>b||c>h)c=h,f=b;b=Math.round((d-c)/2);e=Math.round((e-f)/2)+5;$("#showbox .showbox-image").css({width:c+"px",height:f+
"px","margin-left":b+"px","margin-top":e+"px"}).find(" img").css({width:c+"px",height:f+"px"});d=Math.round(d/2)-(64*ShowBox._index+30);$("#showbox .showbox-th-container").animate({left:d},{duration:300,queue:!1})}}};